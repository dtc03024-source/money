<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>개인 카드 추가 사용 가능액 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    h1 { font-size: 20px; margin-bottom: 8px; }
    h2 { font-size: 18px; margin-top: 16px; margin-bottom: 8px; }
    .card {
      background: #ffffff;
      border-radius: 8px;
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    label { display: block; font-size: 13px; margin-top: 6px; }
    input[type="number"], input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 6px 8px;
      margin-top: 2px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 13px;
    }
    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      background: #1976d2;
      color: #fff;
    }
    button:active { background: #115293; }
    .result { font-size: 14px; line-height: 1.6; }
    .result strong { font-weight: 600; }
    .small {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
  </style>
</head>
<body>

<h1>개인 카드 추가 사용 가능액 계산기</h1>
<div class="small">※ 신용/체크카드 위주, 간이 연말정산 참고용</div>

<div class="card">
  <h2>올해 예상 총급여</h2>
  <label>올해 지금까지 근무한 개월 수 (예: 8)
    <input id="months_worked" type="number" min="0" max="12" value="8">
  </label>

  <label>지금까지 받은 총급여 합계(세전, 원)
    <input id="ytd_salary" type="text" placeholder="예: 24,000,000"
      oninput="showUnit('ytd_salary', 'ytd_salary_unit')">
    <div class="small" id="ytd_salary_unit">0원</div>
  </label>

  <label>현재 월급(세전, 원)
    <input id="current_month_salary" type="text" placeholder="예: 3,000,000"
      oninput="showUnit('current_month_salary', 'current_month_salary_unit')">
    <div class="small" id="current_month_salary_unit">0원</div>
  </label>

  <label>남은 기간 보너스/성과급 예상 합계(원, 없으면 0)
    <input id="expected_bonus_rest" type="text" value="0"
      oninput="showUnit('expected_bonus_rest', 'expected_bonus_rest_unit')">
    <div class="small" id="expected_bonus_rest_unit">0원</div>
  </label>
</div>

<div class="card">
  <h2>현재까지 카드 사용액</h2>

  <label>신용카드 사용액 합계(원)
    <input id="credit_spent" type="text" placeholder="예: 10,000,000"
      oninput="showUnit('credit_spent', 'credit_spent_unit')">
    <div class="small" id="credit_spent_unit">0원</div>
  </label>

  <label>체크/현금영수증 사용액 합계(원)
    <input id="check_spent" type="text" placeholder="예: 3,000,000"
      oninput="showUnit('check_spent', 'check_spent_unit')">
    <div class="small" id="check_spent_unit">0원</div>
  </label>
</div>

<button onclick="runCalc()">계산하기</button>

<div class="card">
  <h2>결과</h2>
  <div id="detailResult" class="result"></div>
  <hr>
  <div class="result">
    <strong>핵심 숫자</strong><br>
    <span id="summaryResult"></span>
  </div>
</div>

<script>
  function parseNumber(str) {
    if (!str) return 0;
    const cleaned = str.toString().replace(/,/g, '').trim();
    if (cleaned === '') return 0;
    const n = Number(cleaned);
    return isNaN(n) ? 0 : n;
  }

  function formatKRW(n) {
    return n.toLocaleString('ko-KR');
  }

  function formatKoreanUnit(n) {
    n = Math.floor(n || 0);
    if (n <= 0) return "0원";

    let result = "";
    const eok = Math.floor(n / 100000000);
    const man = Math.floor((n % 100000000) / 10000);
    let rest = n % 10000;

    const cheon = Math.floor(rest / 1000); rest %= 1000;
    const baek  = Math.floor(rest / 100);  rest %= 100;
    const sip   = Math.floor(rest / 10);
    const il    = rest % 10;

    if (eok > 0) result += `${eok}억 `;
    if (man > 0) result += `${man}만 `;
    if (cheon > 0) result += `${cheon}천 `;
    if (baek > 0) result += `${baek}백 `;
    if (sip > 0) result += `${sip}십 `;
    if (il > 0) result += `${il}원`;
    else result += "원";

    return result.trim();
  }

  function showUnit(inputId, labelId) {
    const raw = parseNumber(document.getElementById(inputId).value);
    document.getElementById(labelId).innerText = formatKoreanUnit(raw);
  }

  function estimateTotalSalary() {
    const monthsWorked = parseInt(document.getElementById("months_worked").value || "0", 10);
    const ytdSalary = parseNumber(document.getElementById("ytd_salary").value);
    const currentMonthSalary = parseNumber(document.getElementById("current_month_salary").value);
    const expectedBonusRest = parseNumber(document.getElementById("expected_bonus_rest").value);

    let m = monthsWorked;
    if (m < 0) m = 0;
    if (m > 12) m = 12;

    let remainingMonths = 12 - m;
    if (remainingMonths < 0) remainingMonths = 0;

    return ytdSalary + (currentMonthSalary * remainingMonths) + expectedBonusRest;
  }

  function calcCardDeductionBasic(totalSalary, creditSpent, checkSpent) {
    const base = Math.floor(totalSalary * 0.25);
    const totalSpent = creditSpent + checkSpent;

    let limit = totalSalary <= 70_000_000 ? 3_000_000 : 2_500_000;

    if (totalSpent <= base || totalSpent <= 0) {
      return { nowDeduction: 0, limit, remain: limit, base };
    }

    const excess = totalSpent - base;
    const creditRatio = totalSpent > 0 ? (creditSpent / totalSpent) : 0;
    const excessCredit = excess * creditRatio;
    const excessCheck = excess * (1 - creditRatio);

    let nowDeduction = Math.floor(excessCredit * 0.15 + excessCheck * 0.30);
    if (nowDeduction > limit) nowDeduction = limit;

    return { nowDeduction, limit, remain: limit - nowDeduction, base };
  }

  function calcExtraLimits(remainDeduction) {
    if (remainDeduction <= 0) return { creditNeeded: 0, checkNeeded: 0 };
    return {
      creditNeeded: Math.floor(remainDeduction / 0.15),
      checkNeeded:  Math.floor(remainDeduction / 0.30)
    };
  }

  function runCalc() {
    const totalSalary = estimateTotalSalary();
    const creditSpent = parseNumber(document.getElementById("credit_spent").value);
    const checkSpent  = parseNumber(document.getElementById("check_spent").value);

    const { nowDeduction, limit, remain, base } =
      calcCardDeductionBasic(totalSalary, creditSpent, checkSpent);

    const { creditNeeded, checkNeeded } = calcExtraLimits(remain);

    const totalSpent = creditSpent + checkSpent;

    document.getElementById("detailResult").innerHTML =
      `예상 총급여: ${formatKRW(totalSalary)}원<br>` +
      `총급여 25% 기준 사용액: ${formatKRW(base)}원<br>` +
      `현재까지 사용액(신용+체크): ${formatKRW(totalSpent)}원<br>` +
      `현재 추정 공제액: ${formatKRW(nowDeduction)}원 / 한도: ${formatKRW(limit)}원<br>` +
      `남은 공제 여유: ${formatKRW(remain)}원<br><br>` +
      `→ 신용카드로 세제 효과 있는 추가 사용 가능액: <strong>${formatKRW(creditNeeded)}원</strong><br>` +
      `→ 체크카드로 세제 효과 있는 추가 사용 가능액: <strong>${formatKRW(checkNeeded)}원</strong>`;

    document.getElementById("summaryResult").innerHTML =
      `신용카드 추가 가능: <strong>${formatKRW(creditNeeded)}원</strong><br>` +
      `체크카드 추가 가능: <strong>${formatKRW(checkNeeded)}원</strong>`;
  }
</script>

</body>
</html>
